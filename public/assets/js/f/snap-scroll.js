!function(e){function n(e){var n=null,t={callbackDelay:300,_lastOrientation:window.orientation,_timeout:0},i={init:function(){window.addEventListener?(window.addEventListener("resize",i._handler_resize,!1),window.addEventListener("orientationchange",i._handler_resize,!1)):window.attachEvent&&(window.attachEvent("onresize",i._handler_resize),window.attachEvent("onorientationchange",i._handler_resize))},destroy:function(){var e=t._timeout;e&&(clearTimeout(e),t._timeout=0),n.onResize=null,window.removeEventListener?(window.removeEventListener("resize",i._handler_resize),window.removeEventListener("orientationchange",i._handler_resize)):window.detachEvent&&(window.detachEvent("onresize",i._handler_resize),window.detachEvent("onorientationchange",i._handler_resize))},getWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},getHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},_handler_resize:function(){if("onorientationchange"in window){var e=window.orientation;if(e==t._lastOrientation)return;t._lastOrientation=e}t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(i._handler_timeout,n.callbackDelay)},_handler_timeout:function(){clearTimeout(t._timeout),t._timeout=0,n.onResize(n.getWidth(),n.getHeight())}};for(var a in n={callbackDelay:t.callbackDelay,init:i.init,destroy:i.destroy,getWidth:i.getWidth,getHeight:i.getHeight,onResize:null},e)n[a]=e[a];return n.init(),n}e.fn.SnapScroll=function(t){var i=null,a={events:!0,eventChangeActive:"snapscroll_change-active",eventChangeVisible:"snapscroll_change-visible",classes:!0,classSnap:"snap-scroll",classVisible:"snap-scroll-visible",classActive:"snap-scroll-active",hashes:!1,scrollDelay:300,wheelInterval:1e3,animateDuration:250,animateTimeBuffer:100,snapTop:!0,snapBottom:!0,snaps:[],maxWheelDeviation:100};e.fn.SnapScroll.defaults=a;var s=100,l={_$this:this,_resizer:null,_snaps:null,_currentSnapIndex:-1,_scrollTimeout:0,_lastanimateDuration:0,_wheelDir:0,_lastWheelTime:0,_wheelEventDeltas:[],_wheelEventDeltaAvg:0,_lastWheelEventTime:0},o={init:function(){i.classes&&l._$this.addClass(i.classSnap),l._resizer=new n({onResize:o._handler_resize}),o._handler_resize(),e(document).on("scroll",o._handler_document_scroll),e(document).on("keydown",o._handler_document_keydown),e(window).on("DOMMouseScroll mousewheel wheel",o._handler_window_mousewheel)},destroy:function(){e(document).off("scroll",o._handler_document_scroll),e(document).off("keydown",o._handler_document_keydown),e(window).off("DOMMouseScroll mousewheel wheel",o._handler_window_mousewheel),l._resizer&&(l._resizer.destroy(),l._resizer=null),l._snaps=null,l._currentSnapIndex=-1,l._scrollTimeout&&(clearTimeout(l._scrollTimeout),l._scrollTimeout=0),l._lastanimateDuration=0,l._wheelDir=0,l._lastWheelTime=0,l._wheelEventDeltas.splice(0,l._wheelEventDeltas.length),l._wheelEventDeltaAvg=0,l._lastWheelEventTime=0,i.classes&&l._$this.removeClass(i.classSnap)},snapClosest:function(){for(var e=o._getScrollPosition(),n=-1,t=-1,a=l._snaps,s=a.length,r=0;r<s;r++){var c=Math.abs(a[r]-e);(-1==t||c<t)&&(t=c,n=r)}i.snapIndex(n)},snapPrev:function(){i.snapIndex(l._currentSnapIndex-1)},snapNext:function(){i.snapIndex(l._currentSnapIndex+1)},snapIndex:function(n){n=Math.min(Math.max(n,0),l._snaps.length-1),l._currentSnapIndex=n;var t=l._snaps[n],a=[],s=null;if(l._$this.each(function(){var n=e(this);s||n.offset().top!=t||(s=n),i.classes&&(s==n?n.hasClass(i.classActive)||(n.addClass(i.classActive),a.push(n)):n.hasClass(i.classActive)&&(n.removeClass(i.classActive),a.push(n)))}),i.events){var r=a.length;if(r)for(var c=0;c<r;c++)a[c].trigger(i.eventChangeActive,s)}if(i.hashes){var _="";if(s){var h=s.attr("id");h&&(_="#"+h)}history.replaceState({},window.location.href,window.location.href.replace(/#.*$/,"")+_)}o._evalVisibility(),o._scrollTo(t)},getSnapIndex:function(){return l._currentSnapIndex},update:function(){var n=i.snaps.concat(),t=e(document).height()-window.innerHeight;return l._$this.each(function(){n.push(e(this).offset().top)}),i.snapTop&&n.push(0),i.snapBottom&&n.push(t),(n=n.reduce(function(e,n){return-1==e.indexOf(n)&&n<=t&&e.push(n),e},[])).sort(o._sortNumeric),l._snaps=n,l._snaps},isVisible:function(e){var n=e.offset().top,t=n+e.height(),i=o._getScrollPosition(),a=i+window.innerHeight;return n>=i&&n<a||t>i&&t<=a},_evalVisibility:function(){if(i.classes){var n=[],t=[];if(l._$this.each(function(){var a=e(this);i.isVisible(a)?(a.hasClass(i.classVisible)||(a.addClass(i.classVisible),n.push(a)),t.push(a)):a.hasClass(i.classVisible)&&(a.removeClass(i.classVisible),n.push(a))}),i.events)for(var a=n.length,s=0;s<a;s++)n[s].trigger(i.eventChangeVisible,{data:t})}},_sortNumeric:function(e,n){return e-n},_handler_document_scroll:function(e){i.classes&&o._evalVisibility(),l._scrollTimeout&&clearTimeout(l._scrollTimeout);var n=l._lastanimateDuration+i.animateDuration+i.animateTimeBuffer-(new Date).getTime();l._scrollTimeout=setTimeout(o._handler_scroll_timeout,Math.max(i.scrollDelay,n))},_handler_scroll_timeout:function(){clearTimeout(l._scrollTimeout),l._scrollTimeout=0,i.snapClosest()},_scrollTo:function(n){if(o._getScrollPosition()!=n){l._lastanimateDuration=(new Date).getTime();var t=e("html,body");t.stop(!0),t.animate({scrollTop:n},i.animateDuration)}},_handler_window_mousewheel:function(e){e.preventDefault();var n=!1,t=(new Date).getTime();if(l._lastWheelEventTime){var a=t-l._lastWheelEventTime,r=l._wheelEventDeltas.length;r==s&&l._wheelEventDeltas.shift(),l._wheelEventDeltas.push(a),r++,l._wheelEventDeltaAvg=(l._wheelEventDeltaAvg*(r-1)+a)/r,Math.abs(a-l._wheelEventDeltaAvg)>=i.maxWheelDeviation&&(l._wheelEventDeltas.splice(0,r),n=!0)}else n=!0;l._lastWheelEventTime=t;var c=Math.max(-1,Math.min(1,e.originalEvent.deltaY||e.originalEvent.wheelDelta||-e.originalEvent.detail));return l._wheelDir=Math.abs(c)/c,(n||(new Date).getTime()>=l._lastWheelTime+i.wheelInterval)&&o._handler_wheel_timeout(),!1},_handler_wheel_timeout:function(){l._lastWheelTime=(new Date).getTime(),l._wheelDir<0?i.snapPrev():l._wheelDir>0&&i.snapNext()},_handler_document_keydown:function(e){switch(e.keyCode){case 38:i.snapPrev();break;case 40:i.snapNext()}},_handler_resize:function(e,n){i.update(),-1==l._currentSnapIndex?i.snapClosest():i.snapIndex(l._currentSnapIndex)},_getScrollPosition:function(){return window.scrollY||document.body.scrollTop||document.documentElement.scrollTop}};return(i=e.extend({init:o.init,destroy:o.destroy,snapClosest:o.snapClosest,snapPrev:o.snapPrev,snapNext:o.snapNext,snapIndex:o.snapIndex,getSnapIndex:o.getSnapIndex,update:o.update,isVisible:o.isVisible},a,t)).init(),i}}(jQuery);
